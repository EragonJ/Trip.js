!function(window,$){var Trip=function(tripData,userOptions){this.settings=$.extend({tripIndex:0,tripTheme:"black",backToTopWhenEnded:false,overlayZindex:99999,delay:1e3,enableKeyBinding:true,onTripStart:$.noop,onTripEnd:$.noop,onTripStop:$.noop},userOptions);this.tripData=tripData;this.$tripBlock=null;this.$tripArrow=null;this.$overlay=null;this.$bar=null;this.$root=$("body, html");this.tripIndex=this.settings.tripIndex;this.timer=null;this.progressing=false;this.hasExpose=false;this.CONSTANTS={LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,ESC:27,SPACE:32};this.console=window.console||{}};Trip.prototype={preInit:function(){if(typeof this.console==="undefined"){var self=this,methods=["log","warn","debug","info","error"];$.each(methods,function(i,methodName){self.console[methodName]=$.noop})}},showExpose:function($sel){this.hasExpose=true;var oldCSS,newCSS;oldCSS={position:$sel.css("position"),zIndex:$sel.css("z-Index")};newCSS={position:"relative",zIndex:this.settings.overlayZindex+1};$sel.data("trip-old-css",oldCSS).css(newCSS).addClass("trip-exposed");this.$overlay.show()},hideExpose:function(){this.hasExpose=false;var $exposedSel=$(".trip-exposed"),oldCSS=$exposedSel.data("trip-old-css");$exposedSel.css(oldCSS).removeClass("trip-exposed");this.$overlay.hide()},bindKeyEvents:function(){var that=this;$(document).on({"keydown.Trip":function(e){that.keyEvent.call(that,e)}})},unbindKeyEvents:function(){$(document).off("keydown.Trip")},keyEvent:function(e){switch(e.which){case this.CONSTANTS["ESC"]:this.stop();break;case this.CONSTANTS["SPACE"]:e.preventDefault();this.pause();break;case this.CONSTANTS["LEFT_ARROW"]:case this.CONSTANTS["UP_ARROW"]:this.prev();break;case this.CONSTANTS["RIGHT_ARROW"]:case this.CONSTANTS["DOWN_ARROW"]:this.next();break}},stop:function(){if(this.timer)this.timer.stop();if(this.hasExpose){this.hideExpose()}this.tripIndex=this.settings.tripIndex;this.hideTripBlock();this.settings.onTripStop()},pause:function(){if(this.progressing){this.timer.pause();this.pauseProgressBar()}else{var remainingTime=this.timer.resume();this.resumeProgressBar(remainingTime)}this.progressing=!this.progressing},next:function(){if(this.hasCallback()){this.callCallback()}if(this.isLast()){this.doLastOperation()}else{this.increaseIndex();this.run()}},prev:function(){if(this.isFirst()){}else{this.decreaseIndex();this.run()}},showCurrentTrip:function(o){if(typeof o.sel==="string"){o.sel=$(o.sel)}if(this.timer){this.timer.stop()}if(this.hasExpose){this.hideExpose()}if(this.progressing){this.hideProgressBar();this.progressing=false}var tripDataOk=this.checkTripData(o);if(tripDataOk){this.setTripBlock(o);this.showTripBlock(o);if(o.expose){this.showExpose(o.sel)}}},doLastOperation:function(){if(this.timer){this.timer.stop()}if(this.settings.enableKeyBinding){this.unbindKeyEvents()}this.hideTripBlock();if(this.hasExpose){this.hideExpose()}if(this.settings.backToTopWhenEnded){this.$root.animate({scrollTop:0},"slow")}this.tripIndex=this.settings.tripIndex;this.settings.onTripEnd();return false},showProgressBar:function(delay){var that=this;this.$bar.animate({width:"100%"},delay,"linear",function(){that.$bar.width(0)})},hideProgressBar:function(){this.$bar.width(0);this.$bar.stop(true)},pauseProgressBar:function(){this.$bar.stop(true)},resumeProgressBar:function(remainingTime){this.showProgressBar(remainingTime)},run:function(){var that=this,tripObject=this.getCurrentTripObject(),delay=tripObject.delay||this.settings.delay;this.showCurrentTrip(tripObject);this.showProgressBar(delay);this.progressing=true;if(delay>=0)this.timer=new Timer(that.next,delay)},isFirst:function(){return this.tripIndex===0?true:false},isLast:function(){return this.tripIndex===this.tripData.length-1?true:false},hasCallback:function(){return typeof this.tripData[this.tripIndex].callback!=="undefined"},callCallback:function(){this.tripData[this.tripIndex].callback(this.tripIndex)},increaseIndex:function(){if(this.tripIndex>=this.tripData.length-1){}else{this.tripIndex+=1}},decreaseIndex:function(){if(this.tripIndex<=0){}else{this.tripIndex-=1}},getCurrentTripObject:function(){return this.tripData[this.tripIndex]},checkTripData:function(o){if(typeof o.sel==="undefined"||o.sel===null||o.sel.length===0||typeof o.content==="undefined"){this.console.warn("Your tripData is not valid in obj :"+o+".");return false}return true},setTripBlock:function(o){this.$tripBlock.find(".trip-content").html(o.content);var $sel=o.sel,selWidth=$sel.outerWidth(),selHeight=$sel.outerHeight(),blockWidth=this.$tripBlock.outerWidth(),blockHeight=this.$tripBlock.outerHeight(),arrowHeight=10,arrowWidth=10;this.$tripArrow.removeClass("e s w n");switch(o.position){case"e":this.$tripArrow.addClass("e");this.$tripBlock.css({left:$sel.offset().left+selWidth+arrowWidth,top:$sel.offset().top-(blockHeight-selHeight)/2});break;case"s":this.$tripArrow.addClass("s");this.$tripBlock.css({left:$sel.offset().left+(selWidth-blockWidth)/2,top:$sel.offset().top+selHeight+arrowHeight});break;case"w":this.$tripArrow.addClass("w");this.$tripBlock.css({left:$sel.offset().left-(arrowWidth+blockWidth),top:$sel.offset().top-(blockHeight-selHeight)/2});break;case"n":default:this.$tripArrow.addClass("n");this.$tripBlock.css({left:$sel.offset().left+(selWidth-blockWidth)/2,top:$sel.offset().top-arrowHeight-blockHeight});break}},showTripBlock:function(o){this.$tripBlock.css({display:"inline-block",zIndex:this.settings.overlayZindex+1});var top=this.$tripBlock.offset().top,OFFSET=100;this.$root.animate({scrollTop:top-OFFSET},"slow")},hideTripBlock:function(){this.$tripBlock.fadeOut("slow")},create:function(){if(!this.$tripBlock){this.createTripBlock();this.createOverlay()}},createTripBlock:function(){if(typeof $(".trip-block").get(0)==="undefined"){var html=['<div class="trip-block">','<div class="trip-content"></div>','<div class="trip-progress-wrapper">','<div class="trip-progress-bar"></div>',"</div>",'<div class="trip-arrow"></div>',"</div>"].join("");var $tripBlock=$(html).addClass(this.settings.tripTheme);$("body").append($tripBlock)}},createOverlay:function(){if(typeof $(".trip-overlay").get(0)==="undefined"){var html=['<div class="trip-overlay">',"</div>"].join("");var $overlay=$(html);$overlay.height($(document).height());$("body").append($overlay)}},init:function(){this.preInit();if(this.settings.enableKeyBinding){this.bindKeyEvents()}this.$bar=$(".trip-progress-bar");this.$overlay=$(".trip-overlay");this.$tripArrow=$(".trip-arrow");this.$tripBlock=$(".trip-block")},start:function(){this.settings.onTripStart();this.create();this.init();this.run()}};window.Trip=Trip;function Timer(e,t){var n,r,i=t;this.pause=function(){window.clearTimeout(n);i-=new Date-r};this.resume=function(){r=new Date;n=window.setTimeout(e,i);return i};this.stop=function(){window.clearTimeout(n)};this.resume()}}(window,jQuery);